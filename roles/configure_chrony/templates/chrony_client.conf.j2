# =============================================================================
# CHRONY NTP CLIENT CONFIGURATION
# =============================================================================
# Supports both external NTP servers and internal cluster time sync

{% if use_external_ntp %}
# Use external NTP servers (online mode)
{% for server in external_ntp_servers %}
server {{ server }} iburst
{% endfor %}
{% else %}
# Use master node as NTP server (airgapped mode)
server {{ chrony_master_server }} iburst
{% endif %}

# Use system timezone
driftfile /var/lib/chrony/drift

# Enable kernel synchronization of the real-time clock (RTC)
rtcsync

# Log measurement statistics
logdir /var/log/chrony

# Enable hardware timestamping if available
hwtimestamp *

# Stop bad estimates upsetting machine clock
maxupdateskew 100.0

# This directive tells 'chronyd' to parse the 'adjtime' file to find out
# whether the real-time clock keeps local time or UTC
hwclockfile /etc/adjtime

# This directive enables kernel synchronisation (every 11 minutes) of the
# real-time clock. Note that it can't be used along with the 'rtcfile' directive
rtconutc

# Logging configuration
log tracking measurements statistics

# Step the system clock instead of slewing it if the adjustment is larger than 1 second
makestep 1 3

# Allow chronyd to make large adjustments to the system clock
# This is useful when starting with a significantly wrong time
maxchange 1000 1 2