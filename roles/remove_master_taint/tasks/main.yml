---
# tasks file for conditional_remove_master_taint
- name: Check if taint removal is enabled
  fail:
    msg: "Taint removal is disabled."
  when: not remove_taints

- name: Get all master nodes
  command:  kubectl get node | grep master | awk '{print $1}'
  register: master_nodes
  when: remove_taints
  changed_when: false

- name: Remove specific taints from each master node
  command: kubectl taint nodes {{ item }} key=value:NoSchedule-
  loop: "{{ master_nodes.stdout_lines }}"
  when: remove_taints and master_nodes.stdout != ""

