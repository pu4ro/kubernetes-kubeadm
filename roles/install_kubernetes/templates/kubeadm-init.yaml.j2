apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
clusterName: kubernetes
etcd:
  local:
    dataDir: /var/lib/etcd
dns:
  imageRepository: cr.makina.rocks/external-hub/kubernetes/coredns
imageRepository: cr.makina.rocks/external-hub/kubernetes
networking:
  dnsDomain: {{ dns_domain }}
  serviceSubnet: {{ service_subnet }}
  podSubnet: {{ pod_subnet }}
kubernetesVersion: "{{ kubernetes_version }}"
certificatesDir: /etc/kubernetes/pki
{% if kube_vip_address is defined %}
controlPlaneEndpoint: {{ kube_vip_address }}:{{ kube_vip_port }}
{% endif %}
apiServer:
  extraArgs:
    authorization-mode: Node,RBAC
  certSANs:
{%- filter indent(width=4) %}

- 127.0.0.1
{% if kube_vip_address is defined %}
- {{ kube_vip_address }}
{% endif %}
{% for host in groups['masters'] %}
- {{ hostvars[host].ansible_host }}
{% endfor %}
{%- endfilter %}
controllerManager:
  extraArgs:
    experimental-cluster-signing-duration: 87600h
scheduler: {}