---
- name: Install packages on Ubuntu
  apt:
    name: "{{ item }}"
    state: present
    update_cache: yes
  loop: "{{ ubuntu_packages }}"
  when: ansible_os_family == "Debian"

- name: Install packages on CentOS
  yum:
    name: "{{ item }}"
    state: present
  loop: "{{ centos_packages }}"
  when: ansible_os_family == "RedHat"
  ignore_errors: true

- name: Check for NVIDIA devices
  shell: lspci | grep NVIDIA
  register: nvidia_devices
  ignore_errors: true

- name: Install NVIDIA container toolkit and driver
  yum:
    name: 
      - nvidia-container-toolkit
      - nvidia-driver
      - nvidia-settings
      - cuda-driver
    state: present
  when: nvidia_devices.stdout != "" 

